import java.util.Scanner;

public class Game {
  public static void main(String[] args) {
    String[] dosCastillos = {
        "............................................................................................................................................................",
        "............................................................................................................................................................",
        "..............................................................................                                                                              ",
        "..............................................................................                                                                              ",
        "..............................................................................                                                                              ",
        "..............................................................................                                                                              ",
        "..............................................................................                                                                              ",
        "..............................................................................                                                                              ",
        "..............................................................................                                                                              ",
        "..............                                                   .............                                                                              ",
        "............                                                       ...........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "...........                                                         ..........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "..........      ..................................                   .........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "..........    .....................................          ....    .........                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        ".........    .......................................        ......    ........                              |----------------|%%%%%%%%%%%%%%%%%%%%%%%       ",
        ".........    ..|-----|..........|-------------|.....    .|-----|..    ........                              |   ###%%%%###   |%%%%%%%%%%%%%%%%%%%%%%%       ",
        ".........   ...|::+::|..........O+++++++++++++|....    ..|::+::|...   ........                              |   ##      ##   |%%%%%%%%%%%%%%%%%%%%%%%       ",
        ".........   ...|:+++:|..........|+++++++++++++|...    ...|:+++:|...   ........                    |------|  |   #  ****  #   |%%%%%%%%%%%%%%%%%%%%%%%       ",
        ".........   ...|+++++------------++|-------|++------------+++++|...   ........                    |******|  |     #****#     |%%%%%%%%%%%%%%%%%%%%%%%       ",
        ".........   ...|:++++++++++++++++++|#######|++++++++++++++++++:|...   ........       |--------|----******---|     #****#     |---------###%%%%%%%%%%%       ",
        ".........   ...|::+++++++++++++++++|::###::|+++++++++++++++++::|...   ........       |===*****|******||*****|     #****#     |%%%*****O**#%%%%%%%%%%%       ",
        ".........   ...---|++|-------|-+++-|:*#*#*:|-----|---|---|++|---...   ........       |+===****|XX****||*****|    ###**###    |%%******|**#%%%%%%%%%%%       ",
        ".........   ......|++|---O---|+++++|*******|#####|+++-$$$|++|......   ........       |++|------XX|-----O-|**|    #%%**%%#    |%**|-----###%%%%%%%%%%%       ",
        ".........   ......|++|*#***#*|+++++|*******|#####-+++O*$$|++|......   ........       |++|******XX|*******|**|    #%%**%%#    |%****|%%%%%%%%%%%%%%%%%       ",
        ".........    .....|++|*#***#*|+++++|*******|+++++X+++|**$|++|......   ........       |++|********|*******|**|    #%%**%%#    |*****|%%%%%%%%%%%%%%%%%       ",
        ".........    .....|++|*#####*|+++++O*******|+++++X+++|---|++|......   ........       |++|-**------**-|---|**|    ###**###    |*****|%%%%%%%%%%%%%%%%%       ",
        ".........     ....|++|*******|--+--|--***--|+++++X+++-**$|++|......   ........       |++|#**#%%%%#**#|%%%|**-------****-------**|**|%%%%%%%%%%%%%%%%%       ",
        ".........      ...|++|--***--|+++++|::+++::|+++++|+++O*$$|++|......   ........       |++|%**%%%%%%***|%%%|**********************|**|%%%%%%%%%%%%%%%%%       ",
        ".........       ..|++|+++++++|+++++|:+++++:|+++++|+++|$$$|++|......   ........       |++|%**%|-|%%***|%%%|**********************|XX|%%%%%%%%%%%%%%%%%       ",
        "..........      ..|++|+##+##+|------+++++++--+++|---|----|++|......   ........       |++|**%%|-|%%#**|%%=|-------------|--|-----|XX---|%%%%%%%%%%%%%%       ",
        "...........      .|++|+++++++|++++++++++++++++++|***|**#*|++|......   ........       |++|***%---%%***|%==|    *****    |**|=%%%%|XX***|%%%%%%%%%%%%%%       ",
        "...........       |++|+##+##+|++++++++++++++++++|---|**##|++|......   ........       |++|*#*%***%***%|===|             |**|==%%%|*****-----------|--|       ",
        "............      |++|+++++++|++++++++++++++++++|********|++|......   ........       |++|%*********#%|===|     ***     |**|===|---||***%#%#%#%-**|%%|       ",
        "............      |++|+##+##+--++|----+++----|++|***|****|++|......   ........       |++|%%*|***|*%%%|+==|    *+++*    |**|===||++||**********O**O*%|       ",
        "...........      .|++|+++++++++++|:::+++++:::|++-------**|++|......   ........       |++|%%%|***|%%%%|++=|    **+***   --O|=+=||++|-***%#%#%#%-**|%%|       ",
        "...........     ..|++|++++++++++:|::+++++++::|+++++++++++|++|......   ........       |++-----***------+++|    |#+#|*    **|+++||++|***|----------|%%|       ",
        "..........      ..|++|-------|+::|:+++++++++:|+++++++++++|++|......   ........       |++++++++++++++XX+++|    |+++|*******|+++--++|***-******%%%%|%%|       ",
        "..........     ...|++|*******|----++++   ++++-------|----|++|......   ........       |++++++++++++++XX+++------#+#---------+++XX++|***********%%%|%%|       ",
        ".........      ...|++|**|---*|+++++++     ++++++++++|++++|++|......   ........       --------|-------|+++++++#=+++=#++++++++++XX++|***********%%%|%%|       ",
        ".........     ....|++|**|*#**|+++++++     ++++++++++O++++|++|......   ........               |%%%%%%||++++++++++++++++++++++++|--------**%%***%%%|%%|       ",
        ".........     ....|++|**|*#**|+++++++     ++++++++++|++++|++|......   ........          |-----%%%%%%||++++++++++++++++++++++++|++++++++%%%%%***%%|%%|       ",
        ".........    .....|++|**--|**|++++++++   ++++|-------++++|++|......   ........          |*%%%%%%||%%|------------------***----|+++++++%%%%%%***%*|%%|       ",
        ".........    .....|++|****|**|++++++++++++++:|+++++++++++|++|......   ........          |**%%*%%||%%|                ##***#   |++--|-|%%%%%%%*****%%|       ",
        ".........   ......|++|--**----+++++++++++++::|+-+++++++++|++|......   ........          |%*|-O------|               #*****#   |++++|||%%%%%%***%***%|       ",
        ".........   ......|++|++++++++++++++++++++:::|+++++++++++|++|......   ........          |**|%*%%%%%%|               #****#    |++++|||+%%%%%**%%%|---       ",
        ".........   ......|++|-------------|--+++--|----|+++|----|++|......   ........          |**|%%%%%%%%|              #***##     |-|++|||++|---++|---          ",
        ".........   ......|++|XXXXXXXXXXXXX|::+++::|#***|+++|***#|++|......   ........          |*%------|%%|------|    |---***---|   |--++|--++|+++++|             ",
        ".........   ......|++|X+++++++++++X| :+++: |****|+++|****|++|......   ........          |%%%***%%|%%|******|    |**%******|   |++++|++++|+++++|             ",
        ".........   ......|++|X++XXXXXXXX+X|  +++  |--O--+++--O--|++|......   ........          |%%%%***%|%%-******|    |*%%%**%**|   |++++|++++|++|---             ",
        ".........   ......|++|X++|-----|X+X|  +++  |+++++++++++++|++|......   ........          ------|**|%%%%*||**-####-%%%|-|%%*-###-++|-|++---++|                ",
        ".........   ......|++|X++|%%%%%|X+X| :+++: |--O-|+++|-O--|++|......   ........                |*%|%%***||********%%%|-|%%%*****++|||+++++++|                ",
        ".........   ......|++|X++|*****|X+X|::+++::|****|+++|****|++|......   ........                |%%---|---|*******%%%%---%%******++|||+++++++|                ",
        ".........   ......|++|X++|#####|X+X| :+++: |#***|+++|***#|++|......   ........                |%%%**|----**|####|%%%%*%%%%|###|++----|++|---                ",
        ".........   ......|++|X++|*****|X+X|  +++  |-----+++-----|++|......   ........                |%%%%*|******|    |%%%***%%%|   |+++++||++|                   ",
        ".........   ......|++|X++----**|X+X|  +++  |X+++++++++++%|++|......   ........                ---|**|%*****|    |%%*****%%|   |+++++||++|                   ",
        ".........   ......|++|X++++++++|X+X|  +++  |XX+++++++++%%|++|......   ........                   |*%|%%|----    ---|***|---   ---|++--++|                   ",
        ".........   ......|++|XXXXXXXXX|X+X| :+++: |XXX+++++++%%%|++|......   ........                   |%%|%%|           |***|         |++++++|                   ",
        ".........   ...|---++-----------X+X|::+++::|XXXX+++++%%%%|XX---|...   ........                   |%%-%%|           |***|         |++++++|                   ",
        ".........   ...|::++++++++++++++++X| :+++: |XXXXX+++%%%%%|***$$|...   ........                   |%%%%%|          #|***|#        --------                   ",
        ".........   ...|:+++++++++++++++++X|  +++  |#############|****$|...   ........                   |%%%%%|          #|***|#                                   ",
        ".........   ...|+++++|-------------|  +++  |-------------|*****|...   ........                   -------            +++                                     ",
        ".........   ...|:+++:|.............| :+++: |.............|$***$|...   ........                                      +++                                     ",
        ".........   ...|::+::|.............|::+++::|.............|$$*$$|...   ........                                      +++                                     ",
        ".........    ..-------.............---+++---.............-------..    ........                                      +++                                     ",
        ".........    .....................................................    ........                                      +++                                     ",
        "..........    ...................................................    .........                                      +++                                     ",
        "..........      ......................+++......................      .........                                      +++                                     ",
        "...........                           +++                           ..........                                      +++                                     ",
        "............                          +++                          ...........                                      +++                                     ",
        "..............                        +++                        .............                                      +++                                     ",
        "......................................+++.....................................                                      +++                                     ",
        "..............................................................................                                      +++                                     ",
        "..............................................................................                                      +++                                     ",
        "..............................................................................                                      +++                                     ",
        "..............................................................................                                      +++                                     ",
        "..............................................................................                                      +++                                     ",
        "..............................................................................                                      +++                                     ",
        "............................................................................................................................................................"
    };

    String[] castilloLB = {
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............                                                   .............",
        "............                                                       ...........",
        "...........                                                         ..........",
        "..........      ..................................                   .........",
        "..........    .....................................          ....    .........",
        ".........    .......................................        ......    ........",
        ".........    ..|-----|..........|-------------|.....    .|-----|..    ........",
        ".........   ...|::+::|..........O+++++++++++++|....    ..|::+::|...   ........",
        ".........   ...|:+++:|..........|+++++++++++++|...    ...|:+++:|...   ........",
        ".........   ...|+++++------------++|-------|++------------+++++|...   ........",
        ".........   ...|:++++++++++++++++++|#######|++++++++++++++++++:|...   ........",
        ".........   ...|::+++++++++++++++++|::###::|+++++++++++++++++::|...   ........",
        ".........   ...---|++|-------|-+++-|:*#*#*:|-----|---|---|++|---...   ........",
        ".........   ......|++|---O---|+++++|*******|#####|+++-$$$|++|......   ........",
        ".........   ......|++|*#***#*|+++++|*******|#####-+++O*$$|++|......   ........",
        ".........    .....|++|*#***#*|+++++|*******|+++++X+++|**$|++|......   ........",
        ".........    .....|++|*#####*|+++++O*******|+++++X+++|---|++|......   ........",
        ".........     ....|++|*******|--+--|--***--|+++++X+++-**$|++|......   ........",
        ".........      ...|++|--***--|+++++|::+++::|+++++|+++O*$$|++|......   ........",
        ".........       ..|++|+++++++|+++++|:+++++:|+++++|+++|$$$|++|......   ........",
        "..........      ..|++|+##+##+|------+++++++--+++|---|----|++|......   ........",
        "...........      .|++|+++++++|++++++++++++++++++|***|**#*|++|......   ........",
        "...........       |++|+##+##+|++++++++++++++++++|---|**##|++|......   ........",
        "............      |++|+++++++|++++++++++++++++++|********|++|......   ........",
        "............      |++|+##+##+--++|----+++----|++|***|****|++|......   ........",
        "...........      .|++|+++++++++++|:::+++++:::|++-------**|++|......   ........",
        "...........     ..|++|++++++++++:|::+++++++::|+++++++++++|++|......   ........",
        "..........      ..|++|-------|+::|:+++++++++:|+++++++++++|++|......   ........",
        "..........     ...|++|*******|----++++   ++++-------|----|++|......   ........",
        ".........      ...|++|**|---*|+++++++     ++++++++++|++++|++|......   ........",
        ".........     ....|++|**|*#**|+++++++     ++++++++++O++++|++|......   ........",
        ".........     ....|++|**|*#**|+++++++     ++++++++++|++++|++|......   ........",
        ".........    .....|++|**--|**|++++++++   ++++|-------++++|++|......   ........",
        ".........    .....|++|****|**|++++++++++++++:|+++++++++++|++|......   ........",
        ".........   ......|++|--**----+++++++++++++::|+-+++++++++|++|......   ........",
        ".........   ......|++|++++++++++++++++++++:::|+++++++++++|++|......   ........",
        ".........   ......|++|-------------|--+++--|----|+++|----|++|......   ........",
        ".........   ......|++|XXXXXXXXXXXXX|::+++::|#***|+++|***#|++|......   ........",
        ".........   ......|++|X+++++++++++X| :+++: |****|+++|****|++|......   ........",
        ".........   ......|++|X++XXXXXXXX+X|  +++  |--O--+++--O--|++|......   ........",
        ".........   ......|++|X++|-----|X+X|  +++  |+++++++++++++|++|......   ........",
        ".........   ......|++|X++|%%%%%|X+X| :+++: |--O-|+++|-O--|++|......   ........",
        ".........   ......|++|X++|*****|X+X|::+++::|****|+++|****|++|......   ........",
        ".........   ......|++|X++|#####|X+X| :+++: |#***|+++|***#|++|......   ........",
        ".........   ......|++|X++|*****|X+X|  +++  |-----+++-----|++|......   ........",
        ".........   ......|++|X++----**|X+X|  +++  |X+++++++++++%|++|......   ........",
        ".........   ......|++|X++++++++|X+X|  +++  |XX+++++++++%%|++|......   ........",
        ".........   ......|++|XXXXXXXXX|X+X| :+++: |XXX+++++++%%%|++|......   ........",
        ".........   ...|---++-----------X+X|::+++::|XXXX+++++%%%%|XX---|...   ........",
        ".........   ...|::++++++++++++++++X| :+++: |XXXXX+++%%%%%|***$$|...   ........",
        ".........   ...|:+++++++++++++++++X|  +++  |#############|****$|...   ........",
        ".........   ...|+++++|-------------|  +++  |-------------|*****|...   ........",
        ".........   ...|:+++:|.............| :+++: |.............|$***$|...   ........",
        ".........   ...|::+::|.............|::+++::|.............|$$*$$|...   ........",
        ".........    ..-------.............---+++---.............-------..    ........",
        ".........    .....................................................    ........",
        "..........    ...................................................    .........",
        "..........      ......................+++......................      .........",
        "...........                           +++                           ..........",
        "............                          +++                          ...........",
        "..............                        +++                        .............",
        "......................................+++.....................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        "..............................................................................",
        ".............................................................................."
    };

    String[] castilloEX = {
        "                                                                              ",
        "                                                                              ",
        "                                                                              ",
        "                                                                              ",
        "                                                                              ",
        "                                                                              ",
        "                                                                              ",
        "                                                                              ",
        "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "                                                 %%%%%%%%%%%%%%%%%%%%%%       ",
        "                              |----------------|%%%%%%%%%%%%%%%%%%%%%%%       ",
        "                              |   ###%%%%###   |%%%%%%%%%%%%%%%%%%%%%%%       ",
        "                              |   ##      ##   |%%%%%%%%%%%%%%%%%%%%%%%       ",
        "                    |------|  |   #  ****  #   |%%%%%%%%%%%%%%%%%%%%%%%       ",
        "                    |******|  |     #****#     |%%%%%%%%%%%%%%%%%%%%%%%       ",
        "       |--------|----******---|     #****#     |---------###%%%%%%%%%%%       ",
        "       |===*****|******||*****|     #****#     |%%%*****O**#%%%%%%%%%%%       ",
        "       |+===****|XX****||*****|    ###**###    |%%******|**#%%%%%%%%%%%       ",
        "       |++|------XX|-----O-|**|    #%%**%%#    |%**|-----###%%%%%%%%%%%       ",
        "       |++|******XX|*******|**|    #%%**%%#    |%****|%%%%%%%%%%%%%%%%%       ",
        "       |++|********|*******|**|    #%%**%%#    |*****|%%%%%%%%%%%%%%%%%       ",
        "       |++|-**------**-|---|**|    ###**###    |*****|%%%%%%%%%%%%%%%%%       ",
        "       |++|#**#%%%%#**#|%%%|**-------****-------**|**|%%%%%%%%%%%%%%%%%       ",
        "       |++|%**%%%%%%***|%%%|**********************|**|%%%%%%%%%%%%%%%%%       ",
        "       |++|%**%|-|%%***|%%%|**********************|XX|%%%%%%%%%%%%%%%%%       ",
        "       |++|**%%|-|%%#**|%%=|-------------|--|-----|XX---|%%%%%%%%%%%%%%       ",
        "       |++|***%---%%***|%==|    *****    |**|=%%%%|XX***|%%%%%%%%%%%%%%       ",
        "       |++|*#*%***%***%|===|             |**|==%%%|*****-----------|--|       ",
        "       |++|%*********#%|===|     ***     |**|===|---||***%#%#%#%-**|%%|       ",
        "       |++|%%*|***|*%%%|+==|    *+++*    |**|===||++||**********O**O*%|       ",
        "       |++|%%%|***|%%%%|++=|    **+***   --O|=+=||++|-***%#%#%#%-**|%%|       ",
        "       |++-----***------+++|    |#+#|*    **|+++||++|***|----------|%%|       ",
        "       |++++++++++++++XX+++|    |+++|*******|+++--++|***-******%%%%|%%|       ",
        "       |++++++++++++++XX+++------#+#---------+++XX++|***********%%%|%%|       ",
        "       --------|-------|+++++++#=+++=#++++++++++XX++|***********%%%|%%|       ",
        "               |%%%%%%||++++++++++++++++++++++++|--------**%%***%%%|%%|       ",
        "          |-----%%%%%%||++++++++++++++++++++++++|++++++++%%%%%***%%|%%|       ",
        "          |*%%%%%%||%%|------------------***----|+++++++%%%%%%***%*|%%|       ",
        "          |**%%*%%||%%|                ##***#   |++--|-|%%%%%%%*****%%|       ",
        "          |%*|-O------|               #*****#   |++++|||%%%%%%***%***%|       ",
        "          |**|%*%%%%%%|               #****#    |++++|||+%%%%%**%%%|---       ",
        "          |**|%%%%%%%%|              #***##     |-|++|||++|---++|---          ",
        "          |*%------|%%|------|    |---***---|   |--++|--++|+++++|             ",
        "          |%%%***%%|%%|******|    |**%******|   |++++|++++|+++++|             ",
        "          |%%%%***%|%%-******|    |*%%%**%**|   |++++|++++|++|---             ",
        "          ------|**|%%%%*||**-####-%%%|-|%%*-###-++|-|++---++|                ",
        "                |*%|%%***||********%%%|-|%%%*****++|||+++++++|                ",
        "                |%%---|---|*******%%%%---%%******++|||+++++++|                ",
        "                |%%%**|----**|####|%%%%*%%%%|###|++----|++|---                ",
        "                |%%%%*|******|    |%%%***%%%|   |+++++||++|                   ",
        "                ---|**|%*****|    |%%*****%%|   |+++++||++|                   ",
        "                   |*%|%%|----    ---|***|---   ---|++--++|                   ",
        "                   |%%|%%|           |***|         |++++++|                   ",
        "                   |%%-%%|           |***|         |++++++|                   ",
        "                   |%%%%%|          #|***|#        --------                   ",
        "                   |%%%%%|          #|***|#                                   ",
        "                   -------            +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     ",
        "                                      +++                                     "
    };

    String[] worldMap = castilloLB;
    GameWorld world = new GameWorld(worldMap, 7, 0);
    Player player = new Player(31, 33);
    Renderer renderer = new Renderer();
    Visualizer visualizer = new Visualizer();
    Scanner scanner = new Scanner(System.in);

    boolean playing = true;
    while (playing) {
      renderer.printWorld(worldMap, player, world, visualizer);
      System.out.print("Enter command (w/a/s/d/q/e/o/b/r):  \n");
      System.out.println("w: Up  s: Down  a: Left  d: Right  q: Quit  e: Change skin o: Set path  b: Follow path  r: Reset path");
      char command = scanner.next().charAt(0);
      switch (command) {
        case 'w':
          player.move(0, worldMap, world);
          break;
        case 's':
          player.move(1, worldMap, world);
          break;
        case 'a':
          player.move(2, worldMap, world);
          break;
        case 'd':
          player.move(3, worldMap, world);
          break;
        case 'q':
          playing = false;
          break;
        case 'e':
          world.changeVisualizationMode();
          break;
        case 'o':
          System.out.println("Enter goal coordinates (x y):");
          int goalX = scanner.nextInt();
          int goalY = scanner.nextInt();
          if (world.solveMaze(dosCastillos, player.getRow(), player.getColumn(), goalX, goalY)) {
            System.out.println("Path found. Press 'b' to start moving.");
          } else {
            System.out.println("No path available.");
          }
          break;
        case 'b':
          player.followPath(world.getPathTaken());
          break;
        case 'r':
          player.followPath(world.getPathTaken());
          break;
        default:
          break;
      }
      world.updateTime();
    }
    scanner.close();
  }
}
